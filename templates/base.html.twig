<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ app_name }}{% endblock %}</title>
    <link rel="icon" type="image/png" href="/images/logo-itroom.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    {% block stylesheets %}
        <style>
            :root {
                --primary-color: #f59c16;
                --primary-dark: #d98913;
                --info-color: #016dae;
                --info-dark: #014d7a;
                --secondary-color: #5a6268;
                --secondary-dark: #454d53;
                --critical-color: #dc3545;
                --major-color: #fd7e14;
                --minor-color: #ffc107;
                --success-color: #198754;

                /* Light mode colors */
                --text-dark: #333;
                --text-medium: #4c4c4c;
                --text-light: #999;
                --bg-light: #f8f8f8;
                --bg-white: #ffffff;
                --border-color: #dee2e6;
                --shadow-color: rgba(0,0,0,.08);
                --card-bg: #ffffff;
                --navbar-bg: #ffffff;
                --footer-bg: #ffffff;
                --input-bg: #ffffff;
                --code-bg: #f8f8f8;
            }

            [data-theme="dark"] {
                --text-dark: #e0e0e0;
                --text-medium: #b0b0b0;
                --text-light: #808080;
                --bg-light: #1a1a1a;
                --bg-white: #242424;
                --border-color: #3a3a3a;
                --shadow-color: rgba(0,0,0,.3);
                --card-bg: #2a2a2a;
                --navbar-bg: #1f1f1f;
                --footer-bg: #1f1f1f;
                --input-bg: #2a2a2a;
                --code-bg: #1a1a1a;
            }

            * {
                transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
            }

            body {
                font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
                background-color: var(--bg-light);
                font-size: 18px;
                line-height: 1.5;
                color: var(--text-medium);
            }

            .navbar {
                background-color: var(--navbar-bg) !important;
                box-shadow: 0 2px 10px var(--shadow-color);
                border-bottom: 2px solid transparent;
                transition: all 0.3s ease;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1000;
            }

            .navbar-brand {
                color: var(--text-dark) !important;
                font-weight: 700;
                font-size: 1.5rem;
            }

            .navbar .nav-link {
                color: var(--text-medium) !important;
                font-weight: 600;
                padding: 0.5rem 1rem;
                transition: all 0.1s ease-in-out;
                border-bottom: 2px solid transparent;
            }

            .navbar .nav-link:hover {
                color: var(--info-color) !important;
                border-bottom-color: var(--info-dark);
            }

            body {
                padding-top: 70px;
            }

            .sidebar {
                min-height: calc(100vh - 70px);
                background-color: var(--card-bg);
                border-right: 1px solid var(--border-color);
                padding-top: 1rem;
            }

            .sidebar .nav-link {
                color: var(--text-medium);
                font-weight: 600;
                padding: 12px 20px;
                margin: 4px 0;
                border-radius: 0;
                border-left: 3px solid transparent;
                transition: all 0.2s ease;
            }

            .sidebar .nav-link:hover,
            .sidebar .nav-link.active {
                color: var(--info-color);
                background-color: rgba(1, 109, 174, 0.05);
                border-left-color: var(--info-color);
            }

            .content-area {
                padding: 2rem;
            }

            .severity-badge {
                font-size: 0.875rem;
                font-weight: 600;
                padding: 0.375rem 0.75rem;
                border-radius: 8px;
            }

            .severity-critical {
                background-color: var(--critical-color);
                color: white;
            }

            .severity-major {
                background-color: var(--major-color);
                color: white;
            }

            .severity-minor {
                background-color: var(--minor-color);
                color: #000;
            }

            h1, h2, h3, h4, h5, h6 {
                font-family: 'Open Sans', sans-serif;
                color: #000;
                font-weight: 400;
            }

            h2 {
                font-size: 1.7rem;
            }

            h3 {
                font-size: 1.5rem;
            }

            .btn-primary {
                background-color: var(--primary-color);
                border-color: var(--primary-color);
                border-radius: 8px;
                padding: 10px 24px;
                font-weight: 600;
                transition: all 0.3s ease;
            }

            .btn-primary:hover {
                background-color: var(--primary-dark);
                border-color: var(--primary-dark);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(245, 156, 22, 0.3);
            }

            .btn-secondary {
                background-color: var(--secondary-color);
                border-color: var(--secondary-color);
                border-radius: 8px;
                padding: 10px 24px;
                font-weight: 600;
                transition: all 0.3s ease;
            }

            .btn-secondary:hover {
                background-color: var(--secondary-dark);
                border-color: var(--secondary-dark);
            }

            .btn {
                border-radius: 8px;
            }

            .card {
                border: none;
                background-color: var(--card-bg);
                box-shadow: 0 2px 8px var(--shadow-color);
                margin-bottom: 1.5rem;
                border-radius: 8px;
                transition: all 0.3s ease;
            }

            .card:hover {
                box-shadow: 0 4px 16px var(--shadow-color);
            }

            .card-body, .card-header, .card-footer {
                background-color: var(--card-bg);
                color: var(--text-medium);
            }

            .card-header {
                border-bottom: 1px solid var(--border-color);
            }

            .stat-card {
                border-left: 4px solid var(--info-color);
            }

            .form-control, .form-select {
                border-radius: 8px;
                padding: 12px 16px;
                border: 1px solid var(--border-color);
                background-color: var(--input-bg);
                color: var(--text-dark);
                font-size: 16px;
                transition: all 0.2s ease;
            }

            .form-control:focus, .form-select:focus {
                border-color: var(--info-color);
                background-color: var(--input-bg);
                box-shadow: 0 0 0 0.2rem rgba(1, 109, 174, 0.25);
                color: var(--text-dark);
            }

            pre code {
                display: block;
                padding: 1rem;
                background-color: var(--code-bg);
                border-radius: 8px;
                overflow-x: auto;
                color: var(--text-dark);
            }

            .conformity-rate {
                font-size: 3rem;
                font-weight: 700;
                color: var(--info-color);
            }

            .chart-container {
                position: relative;
                height: 300px;
            }

            .table {
                background-color: var(--card-bg);
                color: var(--text-medium);
            }

            .table thead {
                background-color: var(--bg-light);
                color: var(--text-dark);
            }

            .table tbody tr {
                border-color: var(--border-color);
            }

            .table tbody tr:hover {
                background-color: var(--bg-light);
            }

            .badge {
                font-weight: 600;
                padding: 6px 12px;
                border-radius: 8px;
            }

            .dropdown-menu {
                border: none;
                box-shadow: 0 4px 12px rgba(0,0,0,.1);
                border-radius: 8px;
                margin-top: 8px;
            }

            .dropdown-item {
                padding: 10px 20px;
                color: var(--text-medium);
                transition: all 0.2s ease;
            }

            .dropdown-item:hover {
                background-color: rgba(1, 109, 174, 0.05);
                color: var(--info-color);
            }

            .alert {
                border-radius: 8px;
                border: none;
                box-shadow: 0 2px 8px rgba(0,0,0,.08);
            }

            a {
                color: var(--info-color);
                text-decoration: none;
                transition: color 0.2s ease;
            }

            a:hover {
                color: var(--info-dark);
            }

            .navbar-toggler {
                border: none;
            }

            .navbar-toggler:focus {
                box-shadow: none;
            }

            .footer {
                background-color: var(--footer-bg);
                box-shadow: 0 -2px 10px var(--shadow-color);
                margin-top: auto;
            }

            .footer a {
                transition: color 0.2s ease;
            }

            .footer a:hover {
                color: var(--info-color) !important;
            }

            html {
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            body {
                flex: 1;
                display: flex;
                flex-direction: column;
            }

            .container-fluid {
                flex: 1;
            }

            /* Dark Mode Toggle */
            .theme-toggle {
                position: relative;
                display: inline-block;
                width: 50px;
                height: 26px;
            }

            .theme-toggle input {
                opacity: 0;
                width: 0;
                height: 0;
            }

            .theme-toggle-slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                transition: .3s;
                border-radius: 13px;
            }

            .theme-toggle-slider:before {
                position: absolute;
                content: "☀️";
                height: 20px;
                width: 20px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                transition: .3s;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
            }

            .theme-toggle input:checked + .theme-toggle-slider {
                background-color: var(--info-color);
            }

            .theme-toggle input:checked + .theme-toggle-slider:before {
                transform: translateX(24px);
                content: "🌙";
            }

            .accordion-item {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
                border-radius: 8px !important;
                margin-bottom: 8px;
                overflow: hidden;
                transition: all 0.2s ease;
            }

            .accordion-item:hover {
                box-shadow: 0 2px 8px var(--shadow-color);
            }

            .accordion-button {
                background-color: var(--bg-light);
                color: var(--text-dark);
                border: none;
                padding: 16px 20px;
                font-weight: 500;
                transition: all 0.2s ease;
            }

            .accordion-button:hover {
                background-color: rgba(1, 109, 174, 0.05);
            }

            .accordion-button:not(.collapsed) {
                background-color: rgba(1, 109, 174, 0.08);
                color: var(--info-color);
                box-shadow: none;
            }

            .accordion-button:focus {
                box-shadow: none;
                border-color: transparent;
            }

            .dropdown-menu {
                background-color: var(--card-bg);
                border-color: var(--border-color);
            }

            .modal-content {
                background-color: var(--card-bg);
                color: var(--text-medium);
            }

            .modal-header, .modal-footer {
                border-color: var(--border-color);
            }

            /* Logo visibility in dark mode */
            [data-theme="dark"] .navbar-brand img,
            [data-theme="dark"] .footer img {
                filter: brightness(0.9);
            }

            /* Alert styles */
            .alert {
                border-color: var(--border-color);
            }

            /* Tabs navigation */
            .nav-tabs .nav-link {
                color: var(--text-medium);
                border: none;
                border-bottom: 3px solid transparent;
                transition: all 0.2s ease;
            }

            .nav-tabs .nav-link:hover {
                color: var(--info-color);
                border-bottom-color: var(--info-color);
            }

            .nav-tabs .nav-link.active {
                color: var(--info-color);
                background-color: transparent;
                border: none;
                border-bottom: 3px solid var(--info-color);
                font-weight: 600;
            }

            /* Modern Radio Buttons for RGAA Grid */
            .manual-check-row .btn-group-vertical {
                display: flex;
                flex-direction: row;
                gap: 8px;
                width: 100%;
                align-items: center;
                justify-content: center;
            }

            .manual-check-row .btn-check {
                display: none;
            }

            .manual-check-row .btn {
                border-radius: 8px;
                padding: 8px 16px;
                font-size: 14px;
                font-weight: 500;
                border: 2px solid;
                transition: all 0.2s ease;
                flex: 1;
            }

            .manual-check-row .btn-outline-success {
                border-color: #198754;
                color: #198754;
                background-color: transparent;
                border-radius: 8px !important;
            }

            .manual-check-row .btn-outline-success:hover {
                background-color: rgba(25, 135, 84, 0.1);
                border-radius: 8px !important;
            }

            .manual-check-row .btn-check:checked + .btn-outline-success {
                background-color: #198754;
                color: white;
                border-color: #198754;
                border-radius: 8px !important;
            }

            .manual-check-row .btn-outline-danger {
                border-color: #dc3545;
                color: #dc3545;
                background-color: transparent;
                border-radius: 8px !important;
            }

            .manual-check-row .btn-outline-danger:hover {
                background-color: rgba(220, 53, 69, 0.1);
                border-radius: 8px !important;
            }

            .manual-check-row .btn-check:checked + .btn-outline-danger {
                background-color: #dc3545;
                color: white;
                border-color: #dc3545;
                border-radius: 8px !important;
            }

            .manual-check-row .btn-outline-secondary {
                border-color: var(--secondary-color);
                color: var(--secondary-color);
                background-color: transparent;
                border-radius: 8px !important;
            }

            .manual-check-row .btn-outline-secondary:hover {
                background-color: rgba(90, 98, 104, 0.1);
                border-radius: 8px !important;
            }

            .manual-check-row .btn-check:checked + .btn-outline-secondary {
                background-color: var(--secondary-color);
                color: white;
                border-color: var(--secondary-color);
                border-radius: 8px !important;
            }

            .manual-check-notes {
                border-radius: 8px !important;
                font-size: 14px;
            }

            /* Center table cells vertically */
            .manual-check-row td {
                vertical-align: middle;
            }

            /* Logo and branding */
            .brand-logo-text {
                color: var(--text-dark);
            }

            .brand-access {
                color: var(--info-color);
                font-weight: 700;
            }

            .brand-it {
                color: var(--info-dark);
                font-weight: 700;
            }

            .brand-audit {
                font-weight: 400;
                font-size: 0.9rem;
            }

            /* Footer styles */
            .footer-text {
                font-size: 14px;
            }

            .footer-text-small {
                font-size: 12px;
            }

            .footer-link {
                font-size: 12px;
            }

            .footer-brand {
                color: var(--info-color);
            }

            /* Badge colors */
            .badge-axe-core {
                background-color: #00A7D0;
            }

            /* Table column widths */
            .col-criteria-number {
                width: 8%;
            }

            .col-criteria-level {
                width: 7%;
            }

            .col-criteria-description {
                width: 50%;
            }

            .col-criteria-status {
                width: 35%;
            }

            /* Accordion body scroll */
            .accordion-body-scroll {
                max-height: 400px;
                overflow-y: auto;
            }

            /* Theme card headers (dynamic colors via inline styles ok for Twig variables) */
            .theme-card-header {
                border-left-width: 4px;
                border-left-style: solid;
            }

            /* Progress bar full width */
            .progress-bar-full {
                width: 100%;
            }

            /* Small info text */
            .text-info-small {
                font-size: 0.75rem;
            }
        </style>
    {% endblock %}
</head>
<body>
    {% block navbar %}
        <nav class="navbar navbar-expand-lg navbar-light bg-white">
            <div class="container-fluid px-4">
                <a class="navbar-brand d-flex align-items-center" href="{{ path('app_dashboard') }}">
                    <img src="/images/logo-itroom.png" alt="IT-Room" height="45" class="me-3">
                    <span class="brand-logo-text">
                        <span class="brand-access">Access</span><span class="brand-it">IT</span>
                        <span class="brand-audit">Audit</span>
                    </span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto align-items-center">
                        {% if app.user %}
                            <li class="nav-item me-3">
                                <label class="theme-toggle">
                                    <input type="checkbox" id="theme-toggle-checkbox">
                                    <span class="theme-toggle-slider"></span>
                                </label>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-person-circle"></i> {{ app.user.name }}
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="{{ path('app_logout') }}">
                                        <i class="bi bi-box-arrow-right"></i> Déconnexion
                                    </a></li>
                                </ul>
                            </li>
                        {% else %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ path('app_login') }}">
                                    <i class="bi bi-box-arrow-in-right"></i> Connexion
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>
    {% endblock %}

    {% block body_content %}
        <div class="container-fluid">
            <div class="row">
                {% if app.user %}
                    {% block sidebar %}
                        <nav class="col-md-2 d-md-block sidebar">
                            <div class="position-sticky pt-3">
                                <ul class="nav flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ path('app_dashboard') }}">
                                            <i class="bi bi-speedometer2"></i> Dashboard
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ path('app_audit_new') }}">
                                            <i class="bi bi-plus-circle"></i> Nouvel audit
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ path('app_audit_list') }}">
                                            <i class="bi bi-list-ul"></i> Historique
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </nav>
                    {% endblock %}

                    <main class="col-md-10 ms-sm-auto content-area">
                {% else %}
                    <main class="col-12 content-area">
                {% endif %}
                        {% for label, messages in app.flashes %}
                            {% for message in messages %}
                                <div class="alert alert-{{ label == 'error' ? 'danger' : label }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endfor %}

                        {% block content %}{% endblock %}
                    </main>
            </div>
        </div>
    {% endblock %}

    {% block footer %}
        <footer class="footer mt-5 py-4 bg-white border-top">
            <div class="container-fluid px-4">
                <div class="row align-items-center">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        <img src="/images/logo-itroom.png" alt="IT-Room" height="60" class="mb-2">
                        <p class="text-muted mb-0 footer-text">
                            Solution d'audit d'accessibilité web RGAA/WCAG
                        </p>
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <p class="text-muted mb-1 footer-text">
                            Propulsé par <strong class="footer-brand">IT-Room</strong>
                        </p>
                        <p class="text-muted mb-0 footer-text-small">
                            © {{ "now"|date("Y") }} AccessIT Audit - Tous droits réservés
                        </p>
                        <div class="mt-2">
                            <a href="https://www.itroom.fr" target="_blank" class="text-muted me-3 footer-link">
                                <i class="bi bi-globe"></i> www.itroom.fr
                            </a>
                            <a href="#" class="text-muted footer-link">
                                <i class="bi bi-shield-check"></i> Mentions légales
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    {% endblock %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <script>
        // Dark Mode Toggle
        const themeToggle = document.getElementById('theme-toggle-checkbox');
        const htmlElement = document.documentElement;

        // Charger le thème sauvegardé ou utiliser le thème système
        const savedTheme = localStorage.getItem('theme');
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const currentTheme = savedTheme || (systemPrefersDark ? 'dark' : 'light');

        // Appliquer le thème au chargement
        if (currentTheme === 'dark') {
            htmlElement.setAttribute('data-theme', 'dark');
            themeToggle.checked = true;
        }

        // Gérer le toggle
        themeToggle.addEventListener('change', function() {
            if (this.checked) {
                htmlElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                htmlElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
            }
        });

        // Écouter les changements de préférence système
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (!localStorage.getItem('theme')) {
                if (e.matches) {
                    htmlElement.setAttribute('data-theme', 'dark');
                    themeToggle.checked = true;
                } else {
                    htmlElement.removeAttribute('data-theme');
                    themeToggle.checked = false;
                }
            }
        });
    </script>

    {% block javascripts %}{% endblock %}
</body>
</html>
